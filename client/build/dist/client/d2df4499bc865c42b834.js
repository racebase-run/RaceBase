(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{817:function(e,t,n){"use strict";n.r(t);n(24);var r,c,o,d=n(3),h=(n(28),{components:{RaceHeader:function(){return n.e(9).then(n.bind(null,846))},RaceActions:function(){return n.e(99).then(n.bind(null,847))},RaceEditor:function(){return n.e(15).then(n.bind(null,841))},ResultsTable:function(){return n.e(17).then(n.bind(null,848))}},head:function(){return{title:this.currentRace.name+" - RaceBase",meta:[{hid:"OpenGraph title",property:"og:title",content:this.currentRace.name},{hid:"OpenGraph image",property:"og:image",content:"https://racebase.run/images/opengraph/results.png"},{hid:"OpenGraph description",property:"og:description",content:this.currentRace.date+" at "+this.currentRace.location}]}},computed:{isLoggedIn:function(){return this.$store.getters["auth/isLoggedIn"]}},asyncData:function(e){return Object(d.a)(regeneratorRuntime.mark((function t(){var n,r,c,o,d,h,l,R,f;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$axios,r=e.params,c=e.redirect,o=e.store,t.next=3,n.$get("race/"+r.id);case 3:if(d=t.sent,h={},d.message){t.next=11;break}return t.next=8,n.$get("race/"+d._id+"/events");case 8:h=t.sent,t.next=12;break;case 11:c("/races/notfound");case 12:if(l={},!o.getters["auth/isLoggedIn"]){t.next=24;break}return t.prev=14,t.next=17,n.$get("race/vote/"+r.id);case 17:l=t.sent,t.next=24;break;case 20:t.prev=20,t.t0=t.catch(14),l={},console.log(t.t0);case 24:if(R={},!r.event){t.next=31;break}return t.next=28,n.$get("event/"+r.event);case 28:R=t.sent,t.next=34;break;case 31:return t.next=33,n.$get("race/"+r.id+"/events/default");case 33:R=t.sent;case 34:return t.next=36,n.$get("result/list/"+d._id+"/event/"+R._id).catch((function(){c("/races/notfound")}));case 36:return f=t.sent,t.abrupt("return",{currentRace:d,eventList:h,results:f,voteData:l,event:R});case 38:case"end":return t.stop()}}),t,null,[[14,20]])})))()},data:function(){return{editMode:!1,addMode:!1,editingRace:!1,currentResult:{}}},methods:{loadResults:(o=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.$get("race/"+this.currentRace._id+"/events").catch((function(){console.log("Something went wrong getting the events list.")}));case 2:return this.eventList=e.sent,e.next=5,this.$axios.$get("result/list/"+this.currentRace._id+"/"+this.event._id).catch((function(){console.log("Something went wrong.")}));case 5:return this.results=e.sent,e.next=8,this.$axios.$get("result/teamlist/"+this.currentRace._id+"/"+encodeURI(this.eventList[this.eventNum])).catch((function(){console.log("Something went wrong.")}));case 8:return this.teamResults=e.sent,e.next=11,setTimeout(_,2e3);case 11:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)}),loadRace:(c=Object(d.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.$get("race/"+this.currentRace._id);case 2:this.currentRace=e.sent,t&&this.loadResults();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)}),closeWindow:function(){this.addMode=!1,this.editMode=!1,this.editingRace=!1,this.currentResult={}},openAddWindow:function(){this.addMode=!0,this.editMode=!1,this.editingRace=!1},openEditWindow:function(e){this.addMode=!1,this.editMode=!0,this.currentResult=e},editRace:function(){this.addMode=!1,this.editMode=!1,this.addingRace=!1,this.editingRace=!0}},watch:{$route:(r=Object(d.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.$route.params.event){e.next=6;break}return e.next=3,this.$axios.$get("event/"+this.$route.params.event);case 3:this.event=e.sent,e.next=9;break;case 6:return e.next=8,this.$axios.$get("race/"+this.$route.params.id+"/events/default");case 8:this.event=e.sent;case 9:this.updateResults();case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}}),l=n(16),component=Object(l.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mx-auto w-90 w-md-100 mx-md-0 pl-md-5"},[e.currentRace?n("RaceHeader",{attrs:{race:e.currentRace}}):e._e(),e._v(" "),n("RaceActions",{staticClass:"mb-3",attrs:{eventList:e.eventList,race:e.currentRace,voteData:e.voteData},on:{openAddWindow:e.openAddWindow,editRace:e.editRace,loadRace:e.loadRace}}),e._v(" "),n("RaceEditor",{attrs:{addingRace:!1,editingRace:e.editingRace,race:e.currentRace},on:{closeWindow:e.closeWindow,load:e.loadRace}}),e._v(" "),n("ResultsTable",{attrs:{event:e.event,results:e.results,id:e.currentRace._id}})],1)}),[],!1,null,null,null);t.default=component.exports}}]);